<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Federated Healthcare Analytics - Model Registry</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Outfit', sans-serif;
            background-color: #f8fafc;
            color: #0f172a;
        }

        .clinical-card {
            background-color: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
            transition: box-shadow 0.2s ease-in-out, transform 0.2s ease-in-out;
        }

        .clinical-card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transform: translateY(-2px);
        }
    </style>
</head>

<body class="p-4 md:p-8">

    <div class="max-w-7xl mx-auto space-y-6">

        <!-- Header -->
        <header class="flex justify-between items-center clinical-card p-6 border-t-4 border-sky-500">
            <div class="flex items-center gap-4">
                <svg class="w-12 h-12 text-sky-500" fill="currentColor" viewBox="0 0 20 20"
                    xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd"
                        d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z"
                        clip-rule="evenodd"></path>
                </svg>
                <div>
                    <h1 class="text-3xl font-bold text-slate-800 tracking-tight">Federated <span
                            class="text-sky-600">Healthcare Analytics</span></h1>
                    <p class="text-sm text-slate-500 mt-1 mb-3 font-medium">Model Registry & Governance</p>
                    <div class="flex items-center gap-6">
                        <a href="/"
                            class="text-slate-400 hover:text-slate-600 font-bold text-sm tracking-wide uppercase border-b-2 border-transparent hover:border-slate-300 pb-1 transition-colors">Global
                            Dashboard</a>
                        <a href="/agents"
                            class="text-slate-400 hover:text-slate-600 font-bold text-sm tracking-wide uppercase border-b-2 border-transparent hover:border-slate-300 pb-1 transition-colors">Hospital
                            Details</a>
                        <a href="/models"
                            class="text-sky-600 font-bold text-sm tracking-wide uppercase border-b-2 border-sky-600 pb-1">Model
                            Registry</a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Info Banner -->
        <div class="bg-white rounded-xl border border-slate-200 p-6 flex items-center justify-between shadow-sm">
            <div>
                <h2 class="text-xl font-bold text-slate-800">Federated Global Model — Version History</h2>
                <p class="text-sm text-slate-500 mt-1">Each completed federation run produces a versioned model
                    registered in the MLflow Model Registry.</p>
            </div>
            <div
                class="text-xs font-bold text-emerald-600 bg-emerald-50 px-3 py-1.5 rounded-md border border-emerald-200 uppercase tracking-wider">
                Auto-Versioned
            </div>
        </div>

        <!-- Model Table -->
        <div class="clinical-card overflow-hidden">
            <table class="w-full">
                <thead>
                    <tr class="bg-slate-50 border-b border-slate-200">
                        <th class="text-left px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider">
                            Version</th>
                        <th class="text-left px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider">
                            Accuracy</th>
                        <th class="text-left px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider">Loss
                        </th>
                        <th class="text-left px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider">
                            Precision</th>
                        <th class="text-left px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider">Recall
                        </th>
                        <th class="text-left px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider">Run ID
                        </th>
                        <th class="text-left px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider">Status
                        </th>
                    </tr>
                </thead>
                <tbody id="model-table-body">
                    <tr>
                        <td colspan="7" class="text-center py-12 text-slate-400 italic">Loading model registry...</td>
                    </tr>
                </tbody>
            </table>
        </div>

    </div>

    <script>
        async function fetchModels() {
            try {
                const res = await fetch('/api/models');
                const data = await res.json();
                renderModels(data.models || []);
            } catch (err) {
                console.error("Failed to fetch models:", err);
            }
        }

        function renderModels(models) {
            const tbody = document.getElementById('model-table-body');

            if (!models || models.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center py-12 text-slate-400 italic">
                            <div class="flex flex-col items-center gap-2">
                                <svg class="w-8 h-8 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                                </svg>
                                No models registered yet. Complete a federation run to produce the first version.
                            </div>
                        </td>
                    </tr>`;
                return;
            }

            let html = '';
            models.forEach((m, idx) => {
                const met = m.metrics || {};
                const acc = met.accuracy !== undefined ? (met.accuracy * 100).toFixed(1) + '%' : '—';
                const loss = met.loss !== undefined ? met.loss.toFixed(4) : '—';
                const prec = met.precision !== undefined ? (met.precision * 100).toFixed(1) + '%' : '—';
                const rec = met.recall !== undefined ? (met.recall * 100).toFixed(1) + '%' : '—';
                const runId = (m.run_id || '').substring(0, 12);
                const isLatest = idx === 0;

                html += `
                <tr class="border-b border-slate-100 hover:bg-slate-50 transition-colors ${isLatest ? 'bg-emerald-50/30' : ''}">
                    <td class="px-6 py-4">
                        <div class="flex items-center gap-2">
                            <span class="text-lg font-bold text-slate-800">v${m.version}</span>
                            ${isLatest ? '<span class="text-xs font-bold text-emerald-600 bg-emerald-100 px-2 py-0.5 rounded-full uppercase">Latest</span>' : ''}
                        </div>
                    </td>
                    <td class="px-6 py-4 text-lg font-bold text-emerald-600">${acc}</td>
                    <td class="px-6 py-4 text-lg font-bold text-rose-500">${loss}</td>
                    <td class="px-6 py-4 text-lg font-bold text-sky-600">${prec}</td>
                    <td class="px-6 py-4 text-lg font-bold text-indigo-600">${rec}</td>
                    <td class="px-6 py-4">
                        <code class="text-xs bg-slate-100 px-2 py-1 rounded font-mono text-slate-600">${runId}…</code>
                    </td>
                    <td class="px-6 py-4">
                        <span class="text-xs font-bold px-2 py-1 rounded-full uppercase
                            ${m.status === 'READY' ? 'text-emerald-700 bg-emerald-100' : 'text-slate-500 bg-slate-100'}">
                            ${m.status || 'READY'}
                        </span>
                    </td>
                </tr>`;
            });

            tbody.innerHTML = html;
        }

        // Poll every 5 seconds (model changes are infrequent)
        setInterval(fetchModels, 5000);
        fetchModels();
    </script>
</body>

</html>